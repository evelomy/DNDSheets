<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ¦‡ Tap Sheet Hub</title>
<style>
:root{
  --bg:#0f1115; --card:#151922; --txt:#e8e9ed; --muted:#9aa0aa;
  --good:#3ad29f; --bad:#ff6b6b; --pri:#6ea8fe;
}
*{box-sizing:border-box}
body{
  margin:0; padding:14px;
  background:linear-gradient(180deg,#0b0e13,#0f1115);
  color:var(--txt);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}
h1{font-size:20px;margin:6px 0 12px}
.card{
  background:var(--card);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:14px;
  margin-bottom:12px;
}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
button{
  padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.08); color:var(--txt); font-weight:600;
}
button.good{background:rgba(58,210,159,.18)}
button.bad{background:rgba(255,107,107,.18)}
button.primary{background:rgba(110,168,254,.18)}
button.secondary{background:rgba(255,255,255,.06)}
button:active{transform:translateY(1px)}
.stat{font-size:28px;font-weight:800}
.muted{color:var(--muted);font-size:12px}
.bar{height:10px;border-radius:999px;background:#222;margin-top:8px;overflow:hidden}
.bar > div{height:100%;background:linear-gradient(90deg,#3ad29f,#6ea8fe)}
.chip{
  display:inline-flex;align-items:center;gap:6px;
  padding:6px 10px;border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
  font-size:12px;
}
.charbar{
  position:sticky;top:0;z-index:999;
  display:flex;justify-content:space-between;gap:10px;
  padding:10px;border-radius:16px;margin-bottom:12px;
  background:rgba(0,0,0,.35);backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,.12);
}
select{
  padding:8px 10px;border-radius:12px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.16);
  color:var(--txt);
}
</style>
</head>
<body>

<div class="charbar">
  <div class="row">
    <span class="chip">ğŸ§›â€â™‚ï¸ Sheet</span>
    <select id="charSelect"></select>
    <span class="chip" id="saveChip">ğŸ’¾ saving: ?</span>
  </div>
  <div class="row">
    <button class="secondary" onclick="newChar()">New</button>
    <button class="secondary" onclick="renameChar()">Rename</button>
    <button class="secondary" onclick="dupChar()">Duplicate</button>
    <button class="bad" onclick="delChar()">Delete</button>
  </div>
</div>

<h1>ğŸ¦‡ Tap Sheet Hub</h1>

<div class="card">
  <div class="row">
    <div>
      <div class="muted">Health</div>
      <div class="stat"><span id="currentHP">0</span> / <span id="totalHP">0</span></div>
    </div>
  </div>
  <div class="bar"><div id="hpBar"></div></div>
  <div class="controls">
    <button class="bad" onclick="inc('currentHP',-1)">-1</button>
    <button class="bad" onclick="inc('currentHP',-5)">-5</button>
    <button class="good" onclick="inc('currentHP',1)">+1</button>
    <button class="good" onclick="inc('currentHP',5)">+5</button>
    <button class="primary" onclick="setToMax('currentHP','totalHP')">Max</button>
    <button class="secondary" onclick="setValue('totalHP')">Set Max</button>
  </div>
</div>

<div class="card">
  <div class="muted">Inspiration</div>
  <div class="stat" id="inspirationLabel">No</div>
  <div class="controls">
    <button onclick="toggleInspiration()">Toggle</button>
  </div>
</div>

<div class="card">
  <div class="muted">ğŸ’° Coins</div>
  <div class="row">
    <div>Copper: <span id="cp">0</span></div>
    <div>Silver: <span id="sp">0</span></div>
    <div>Gold: <span id="gp">0</span></div>
  </div>
  <div class="controls">
    <button onclick="inc('cp',1)">+1 CP</button>
    <button onclick="inc('sp',1)">+1 SP</button>
    <button onclick="inc('gp',1)">+1 GP</button>
  </div>
</div>

<script>
const DEFAULT_STATE = {
  currentHP:0,totalHP:0,
  inspiration:false,
  cp:0,sp:0,gp:0
};

const HUB_KEY="tapHub:chars";
const ACTIVE_KEY="tapHub:active";
let activeId=null;
let state={};

function saveChip(ok){
  const el=document.getElementById("saveChip");
  el.textContent = ok ? "ğŸ’¾ saving: OK" : "ğŸ’€ saving: blocked";
}

function loadChars(){
  try{return JSON.parse(localStorage.getItem(HUB_KEY))||[]}catch{return[]}
}
function saveChars(c){localStorage.setItem(HUB_KEY,JSON.stringify(c))}
function key(id){return "tapHub:sheet:"+id}

function loadState(){
  try{
    return {...DEFAULT_STATE,...JSON.parse(localStorage.getItem(key(activeId))||"{}")}
  }catch{return {...DEFAULT_STATE}}
}
function saveState(){
  try{
    localStorage.setItem(key(activeId),JSON.stringify(state));
    saveChip(true);
  }catch(e){saveChip(false)}
}

function render(){
  for(const k in DEFAULT_STATE){
    if(document.getElementById(k)) document.getElementById(k).textContent=state[k];
  }
  document.getElementById("inspirationLabel").textContent=state.inspiration?"Yes":"No";
  const p = state.totalHP? (state.currentHP/state.totalHP)*100:0;
  document.getElementById("hpBar").style.width=p+"%";
}

function inc(k,d){
  state[k]=Math.max(0,(state[k]||0)+d);
  saveState();render();
}
function setValue(k){
  const v=parseInt(prompt("Set value:",state[k]||0),10);
  if(!isNaN(v)){state[k]=v;saveState();render()}
}
function setToMax(k,m){
  state[k]=state[m]||0;saveState();render();
}
function toggleInspiration(){
  state.inspiration=!state.inspiration;saveState();render();
}

function ensure(){
  let chars=loadChars();
  if(!chars.length){
    const id=Math.random().toString(36).slice(2);
    chars=[{id,name:"Count Fuckoula"}];
    saveChars(chars);
    localStorage.setItem(ACTIVE_KEY,id);
    localStorage.setItem(key(id),JSON.stringify(DEFAULT_STATE));
  }
  activeId=localStorage.getItem(ACTIVE_KEY)||chars[0].id;
  const sel=document.getElementById("charSelect");
  sel.innerHTML="";
  chars.forEach(c=>{
    const o=document.createElement("option");
    o.value=c.id;o.textContent=c.name;sel.appendChild(o);
  });
  sel.value=activeId;
  state=loadState();render();
}

function newChar(){
  const n=prompt("New character name?");
  if(!n) return;
  const chars=loadChars();
  const id=Math.random().toString(36).slice(2);
  chars.push({id,name:n});
  saveChars(chars);
  localStorage.setItem(key(id),JSON.stringify(DEFAULT_STATE));
  localStorage.setItem(ACTIVE_KEY,id);
  ensure();
}
function renameChar(){
  const chars=loadChars();
  const c=chars.find(x=>x.id===activeId);
  const n=prompt("Rename:",c.name);
  if(n){c.name=n;saveChars(chars);ensure()}
}
function dupChar(){
  const chars=loadChars();
  const c=chars.find(x=>x.id===activeId);
  const n=prompt("Duplicate as:",c.name+" copy");
  if(!n) return;
  const id=Math.random().toString(36).slice(2);
  chars.push({id,name:n});
  saveChars(chars);
  localStorage.setItem(key(id),JSON.stringify(state));
  localStorage.setItem(ACTIVE_KEY,id);
  ensure();
}
function delChar(){
  if(!confirm("Delete character?")) return;
  let chars=loadChars().filter(c=>c.id!==activeId);
  saveChars(chars);
  if(chars[0]){
    localStorage.setItem(ACTIVE_KEY,chars[0].id);
  }
  ensure();
}

document.getElementById("charSelect").addEventListener("change",e=>{
  localStorage.setItem(ACTIVE_KEY,e.target.value);
  ensure();
});

window.addEventListener("pagehide",saveState);
document.addEventListener("visibilitychange",()=>{
  if(document.visibilityState==="hidden") saveState();
});

ensure();
</script>

</body>
</html>
