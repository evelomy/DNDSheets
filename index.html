<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Count Fuckoula-la-la â€¢ Tap Sheet</title>
<style>
  :root {
    --bg: #0c0c10;
    --panel: rgba(255,255,255,0.06);
    --text: rgba(255,255,255,0.92);
    --muted: rgba(255,255,255,0.66);
    --hair: rgba(255,255,255,0.12);
    --good: #39d98a;
    --warn: #ffcc66;
    --bad: #ff4d6d;
    --accent: #c8a2ff;
    --gold: #ffd56a;
    --shadow: 0 10px 30px rgba(0,0,0,.45);
    --radius: 18px;
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    margin: 0;
    font-family: ui-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(900px 900px at 10% -10%, rgba(200,162,255,.25), transparent 50%),
                radial-gradient(900px 900px at 110% 10%, rgba(255,213,106,.16), transparent 55%),
                radial-gradient(900px 900px at 50% 120%, rgba(57,217,138,.10), transparent 60%),
                var(--bg);
    color: var(--text);
    padding: env(safe-area-inset-top) 14px env(safe-area-inset-bottom) 14px;
  }
  header {
    position: sticky; top: 0;
    backdrop-filter: blur(12px);
    background: linear-gradient(to bottom, rgba(12,12,16,.85), rgba(12,12,16,.55));
    padding: 14px 8px 10px 8px;
    border-bottom: 1px solid var(--hair);
    z-index: 20;
  }
  h1 { margin: 0 0 4px 0; font-size: 22px; letter-spacing: .3px; }
  .sub { display:flex; gap:10px; align-items:center; flex-wrap:wrap; color: var(--muted); font-size: 13px; }
  .pill { padding: 6px 10px; border: 1px solid var(--hair); background: rgba(0,0,0,.22); border-radius: 999px; display:inline-flex; gap:8px; align-items:center; }
  main { max-width: 1000px; margin: 12px auto 24px auto; display: grid; grid-template-columns: 1fr; gap: 12px; }
  @media (min-width: 880px) { main { grid-template-columns: 1.1fr .9fr; } }
  .card { background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0.03)); border: 1px solid var(--hair); border-radius: var(--radius); box-shadow: var(--shadow); padding: 14px; }
  .card h2 { margin: 0 0 10px 0; font-size: 16px; color: rgba(255,255,255,.9); display:flex; align-items:center; gap:10px; }
  .grid { display:grid; gap: 10px; }
  .stat { background: rgba(0,0,0,.18); border: 1px solid rgba(255,255,255,.10); border-radius: 16px; padding: 12px; }
  .stat-top { display:flex; justify-content:space-between; gap:10px; align-items:flex-end; }
  .stat-name { font-weight: 650; }
  .stat-value { font-variant-numeric: tabular-nums; color: rgba(255,255,255,.92); }
  .hint { color: var(--muted); font-size: 12px; margin-top: 6px; }
  .bar { margin-top: 10px; height: 12px; background: rgba(255,255,255,.08); border-radius: 999px; overflow: hidden; border: 1px solid rgba(255,255,255,.08); }
  .bar > div { height: 100%; width: 0%; background: var(--good); transition: width .18s ease; }
  .controls { display:flex; gap: 8px; flex-wrap:wrap; margin-top: 10px; }
  button { appearance: none; border: 1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.25); color: var(--text); padding: 10px 12px; border-radius: 14px; font-size: 14px; font-weight: 650; box-shadow: 0 6px 18px rgba(0,0,0,.25); }
  button:active { transform: scale(.98); }
  button.primary { border-color: rgba(200,162,255,.35); background: rgba(200,162,255,.15); }
  button.good { border-color: rgba(57,217,138,.35); background: rgba(57,217,138,.13); }
  button.bad { border-color: rgba(255,77,109,.35); background: rgba(255,77,109,.13); }
  button.gold { border-color: rgba(255,213,106,.35); background: rgba(255,213,106,.12); }
  button.ghost { background: transparent; border-color: rgba(255,255,255,.10); box-shadow:none; }
  .chips { display:flex; flex-wrap:wrap; gap: 8px; }
  .chip { padding: 10px 12px; border-radius: 999px; border: 1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.18); color: rgba(255,255,255,.86); font-size: 13px; font-weight: 650; user-select: none; }
  .chip.on { background: rgba(200,162,255,.18); border-color: rgba(200,162,255,.42); color: rgba(255,255,255,.95); }
  .two { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .footer-actions { display:flex; gap: 8px; flex-wrap:wrap; margin-top: 10px; }
  textarea { width: 100%; min-height: 120px; background: rgba(0,0,0,.22); border: 1px solid rgba(255,255,255,.12); border-radius: 14px; color: rgba(255,255,255,.9); padding: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; }
  .small { font-size: 12px; color: var(--muted); }
.secondary{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.18);color:var(--txt);}
.secondary:active{transform:translateY(1px);}

/* --- Stat Block card --- */
.statgrid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-top:10px;}
.ability{border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.06);border-radius:16px;padding:10px 12px;text-align:center;}
.ability .k{font-size:12px;letter-spacing:0.5px;opacity:0.8;}
.ability .v{font-size:22px;font-weight:900;margin-top:2px;}
.ability .m{font-size:12px;opacity:0.8;margin-top:2px;}
.skills{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;}
.skill{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-radius:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.10);}
.skill .name{font-weight:700;font-size:13px;}
.skill .val{font-weight:900;font-variant-numeric:tabular-nums;}
.skill .star{opacity:0.75;margin-left:4px;font-weight:900;}
@media (max-width:600px){.statgrid{grid-template-columns:repeat(3,1fr);} .skills{grid-template-columns:1fr;}}

</style>
</head>
<body>
<header>
  <h1>ðŸ¦‡ Count Fuckoula-la-la <span style="opacity:.55;">Â·</span> Tap Sheet</h1>
  <div class="sub">
    <span class="pill">ðŸ“± iOS friendly Â· offline Â· saves automatically</span>
    <span class="pill" id="savePill">ðŸ’¾ saved</span>
  </div>
</header>

<main>
  <section class="card">
    <h2>
  <div class="card" id="statBlockCard">
    <div class="title">ðŸ“œ Stat Block</div>
    <div class="sub">Auto-calculates modifiers + skills. Use <b>Edit</b> when you level up.</div>
    <div class="controls" style="margin-top:10px;">
      <button class="secondary" onclick="TS_editBaseStats()">Edit</button>
      <button class="secondary" onclick="TS_resetBaseStats()">Reset</button>
    </div>

    <div class="statgrid" id="TS_abilityGrid"></div>
    <div class="skills" id="TS_skillsGrid"></div>
    <div class="muted" id="TS_profLine"></div>
  </div>

    ðŸ§¾ Trackers
<span class="muted">Tip: use <b>Set Max</b> when you level up.</span></h2>
    <div class="grid">
      <div class="stat">
        <div class="stat-top">
          <div>
            <div class="stat-name">Health</div>
            <div class="hint" id="hpStatus">â€¦</div>
          </div>
          <div class="stat-value"><span id="currentHP">0</span> / <span id="totalHP">0</span></div>
        </div>
        <div class="bar"><div id="hpBar"></div></div>
        <div class="controls">
          <button class="bad" onclick="inc('currentHP', -1)">-1</button>
          <button class="bad" onclick="inc('currentHP', -5)">-5</button>
          <button class="good" onclick="inc('currentHP', 1)">+1</button>
          <button class="good" onclick="inc('currentHP', 5)">+5</button>
          <button class="primary" onclick="setToMax('currentHP','totalHP')">Max</button>
          <button class="secondary" onclick="setValue('totalHP')">Set Max</button>
        </div>
      </div>

      <div class="two">
        <div class="stat">
          <div class="stat-top">
            <div>
              <div class="stat-name">Temp HP</div>
              <div class="hint">Soak damage before real HP.</div>
            </div>
            <div class="stat-value"><span id="temp_hp">0</span></div>
          </div>
          <div class="controls">
            <button class="bad" onclick="inc('temp_hp', -1)">-1</button>
            <button class="bad" onclick="inc('temp_hp', -5)">-5</button>
            <button class="good" onclick="inc('temp_hp', 1)">+1</button>
            <button class="good" onclick="inc('temp_hp', 5)">+5</button>
            <button class="ghost" onclick="setValue('temp_hp',0)">Clear</button>
          </div>
        </div>

        <div class="stat">
          <div class="stat-top">
            <div>
              <div class="stat-name">Inspiration</div>
              <div class="hint">Toggle like a smug hero.</div>
            </div>
            <div class="stat-value" id="inspirationLabel">No</div>
          </div>
          <div class="controls">
            <button class="primary" onclick="toggleBool('inspiration')">Toggle</button>
          </div>
        </div>
      </div>

      <div class="stat">
        <div class="stat-top">
          <div>
            <div class="stat-name">Blood Points</div>
            <div class="hint" id="bpStatus">â€¦</div>
          </div>
          <div class="stat-value"><span id="current_bp">0</span> / <span id="max_bp">0</span></div>
        </div>
        <div class="bar"><div id="bpBar"></div></div>
        <div class="controls">
          <button class="bad" onclick="inc('current_bp', -1)">-1</button>
          <button class="good" onclick="inc('current_bp', 1)">+1</button>
          <button class="primary" onclick="setToMax('current_bp','max_bp')">Max</button>
          <button class="secondary" onclick="setValue('max_bp')">Set Max</button>
        </div>
      </div>

      <div class="stat">
        <div class="stat-top">
          <div>
            <div class="stat-name">Exhaustion</div>
            <div class="hint" id="exhStatus">â€¦</div>
          </div>
          <div class="stat-value"><span id="cur_exh">0</span> / <span id="max_exh">0</span></div>
        </div>
        <div class="bar"><div id="exhBar"></div></div>
        <div class="controls">
          <button class="bad" onclick="inc('cur_exh', -1)">-1</button>
          <button class="good" onclick="inc('cur_exh', 1)">+1</button>
          <button class="ghost" onclick="setValue('cur_exh',0)">Clear</button>
        </div>
      </div>

      <div class="stat">
        <div class="stat-top">
          <div>
            <div class="stat-name">Fed</div>
            <div class="hint" id="fedStatus">â€¦</div>
          </div>
          <div class="stat-value"><span id="fed">0</span> / <span id="maxfed">0</span></div>
        </div>
        <div class="bar"><div id="fedBar"></div></div>
        <div class="controls">
          <button class="bad" onclick="inc('fed', -1)">-1</button>
          <button class="good" onclick="inc('fed', 1)">+1</button>
          <button class="primary" onclick="setToMax('fed','maxfed')">Max</button>
          <button class="secondary" onclick="setValue('maxfed')">Set Max</button>
        </div>
      </div>

    </div>
  </section>

  <aside class="card">
    <h2>ðŸ©¹ Conditions</h2>
    <div class="chips" id="conditions"></div>
    <div class="hint" style="margin-top:10px;">Tap to toggle. Your DM can argue later.</div>

    <hr style="border:0; border-top:1px solid var(--hair); margin: 14px 0;">

    <h2>ðŸ’° Coin Pouch</h2>
    <div class="grid">
      <div class="stat">
        <div class="stat-top">
          <div class="stat-name">Copper</div>
          <div class="stat-value"><span id="copper">0</span></div>
        </div>
        <div class="controls">
          <button class="bad" onclick="inc('copper', -1)">-1</button>
          <button class="good" onclick="inc('copper', 1)">+1</button>
          <button class="ghost" onclick="promptSet('copper')">Set</button>
        </div>
      </div>

      <div class="stat">
        <div class="stat-top">
          <div class="stat-name">Silver</div>
          <div class="stat-value"><span id="silver">0</span></div>
        </div>
        <div class="controls">
          <button class="bad" onclick="inc('silver', -1)">-1</button>
          <button class="good" onclick="inc('silver', 1)">+1</button>
          <button class="ghost" onclick="promptSet('silver')">Set</button>
        </div>
      </div>

      <div class="stat">
        <div class="stat-top">
          <div class="stat-name">Gold</div>
          <div class="stat-value"><span id="gold">0</span></div>
        </div>
        <div class="controls">
          <button class="bad" onclick="inc('gold', -1)">-1</button>
          <button class="good" onclick="inc('gold', 1)">+1</button>
          <button class="gold" onclick="inc('gold', 10)">+10</button>
          <button class="ghost" onclick="promptSet('gold')">Set</button>
        </div>
      </div>

      <div class="stat">
        <div class="stat-top">
          <div class="stat-name">Platinum</div>
          <div class="stat-value"><span id="platinum">0</span></div>
        </div>
        <div class="controls">
          <button class="bad" onclick="inc('platinum', -1)">-1</button>
          <button class="good" onclick="inc('platinum', 1)">+1</button>
          <button class="ghost" onclick="promptSet('platinum')">Set</button>
        </div>
      </div>
    </div>

    <hr style="border:0; border-top:1px solid var(--hair); margin: 14px 0;">

    <h2>ðŸ§ª Backup / Move to another iPad</h2>
    <div class="small">Export JSON, Airdrop it, import on the other device. Like a vampire, but for data.</div>
    <div class="footer-actions">
      <button class="primary" onclick="exportState()">Export</button>
      <button class="ghost" onclick="importState()">Import</button>
      <button class="bad" onclick="resetAll()">Reset</button>
    </div>
    <textarea id="io" placeholder="Export/import JSON will appear hereâ€¦"></textarea>
  </aside>
</main>

<script>
const STORAGE_KEY = "tapSheet:Count Fuckoula-la-la";
let _storageOK = true;
function storageGet(key){
  try{ return window.storageGet(key); } catch(e){ _storageOK=false; return null; }
}
function storageSet(key, val){
  try{ window.storageSet(key, val); } catch(e){ _storageOK=false; }
}
function storageRemove(key){
  try{ window.storageRemove(key); } catch(e){ _storageOK=false; }
}
const DEFAULT_STATE = {"currentHP": 49, "totalHP": 49, "temp_hp": 0, "current_bp": 1, "max_bp": 3, "cur_exh": 1, "max_exh": 5, "fed": 3, "maxfed": 3, "copper": 0, "silver": 0, "gold": 254, "platinum": 0, "inspiration": true, "conditions": []};

const CONDITIONS = [
  "Blinded","Charmed","Deafened","Frightened","Grappled",
  "Incapacitated","Invisible","Paralyzed","Petrified",
  "Poisoned","Prone","Restrained","Stunned","Unconscious","Claustrophobic"
];

let state = loadState();

function clamp(n, min, max) {
  n = Number.isFinite(n) ? n : 0;
  return Math.max(min, Math.min(max, n));
}

function saveState() {
  storageSet(STORAGE_KEY, JSON.stringify(state));
  const pill = document.getElementById("savePill");
  pill.textContent = "ðŸ’¾ saved";
  pill.style.borderColor = "rgba(57,217,138,.35)";
  pill.style.background = "rgba(57,217,138,.10)";
}

function loadState() {
  try {
    const raw = storageGet(STORAGE_KEY);
    if (!raw) return { ...DEFAULT_STATE, conditions: [] };
    const parsed = JSON.parse(raw);
    return { ...DEFAULT_STATE, ...parsed, conditions: Array.isArray(parsed.conditions) ? parsed.conditions : [] };
  } catch (e) {
    return { ...DEFAULT_STATE, conditions: [] };
  }
}

function setValue(key, val) {
  if (typeof DEFAULT_STATE[key] === "boolean") {
    state[key] = Boolean(val);
  } else {
    state[key] = clamp(parseInt(val, 10), 0, 999999);
  }
  saveState();
  render();
}

function toggleBool(key) {
  state[key] = !Boolean(state[key]);
  saveState();
  render();
}

function inc(key, delta) {
  const cur = parseInt(state[key] ?? 0, 10) || 0;
  let next = cur + delta;

  if (key === "currentHP") {
    next = clamp(next, 0, parseInt(state.totalHP ?? 0, 10) || 0);
  } else if (key === "current_bp") {
    next = clamp(next, 0, parseInt(state.max_bp ?? 0, 10) || 0);
  } else if (key === "cur_exh") {
    next = clamp(next, 0, parseInt(state.max_exh ?? 0, 10) || 6);
  } else if (key === "fed") {
    next = clamp(next, 0, parseInt(state.maxfed ?? 0, 10) || 0);
  } else {
    next = clamp(next, 0, 999999);
  }

  state[key] = next;
  saveState();
  render();
}

function setToMax(curKey, maxKey) {
  const max = parseInt(state[maxKey] ?? 0, 10) || 0;
  state[curKey] = clamp(max, 0, 999999);
  saveState();
  render();
}

function promptSet(key) {
  const cur = state[key] ?? 0;
  const v = prompt(`Set ${key} to:`, String(cur));
  if (v === null) return;
  setValue(key, v);
}

function pct(cur, max) {
  if (!max) return 0;
  return clamp((cur / max) * 100, 0, 100);
}

function statusHP(p) {
  if (p > 66) return "Vital and unyielding.";
  if (p > 34) return "Wounded, but surviving.";
  if (p > 0) return "Barely clinging to life.";
  return "Down. Try not to die, yeah?";
}

function statusGeneric(p, good, mid, low) {
  if (p > 66) return good;
  if (p > 34) return mid;
  return low;
}

function barColor(p) {
  if (p > 66) return "var(--good)";
  if (p > 34) return "var(--warn)";
  return "var(--bad)";
}

function renderConditions() {
  const el = document.getElementById("conditions");
  el.innerHTML = "";
  for (const name of CONDITIONS) {
    const chip = document.createElement("div");
    chip.className = "chip" + (state.conditions.includes(name) ? " on" : "");
    chip.textContent = name;
    chip.addEventListener("click", () => {
      if (state.conditions.includes(name)) {
        state.conditions = state.conditions.filter(x => x !== name);
      } else {
        state.conditions = [...state.conditions, name];
      }
      saveState();
      renderConditions();
    });
    el.appendChild(chip);
  }
}

function render() {
  for (const k of Object.keys(DEFAULT_STATE)) {
    const el = document.getElementById(k);
    if (!el) continue;
    el.textContent = String(state[k] ?? DEFAULT_STATE[k] ?? 0);
  }

  document.getElementById("inspirationLabel").textContent = state.inspiration ? "Yes" : "No";

  const hpP = pct(state.currentHP, state.totalHP);
  document.getElementById("hpBar").style.width = hpP + "%";
  document.getElementById("hpBar").style.background = barColor(hpP);
  document.getElementById("hpStatus").textContent = statusHP(hpP);

  const bpP = pct(state.current_bp, state.max_bp);
  document.getElementById("bpBar").style.width = bpP + "%";
  document.getElementById("bpBar").style.background = barColor(bpP);
  document.getElementById("bpStatus").textContent = statusGeneric(bpP, "Sated enoughâ€¦ for now.", "Hungry. Annoyingly.", "Starving. Don't be weird about it.");

  const exhMax = parseInt(state.max_exh ?? 6, 10) || 6;
  const exhCur = clamp(parseInt(state.cur_exh ?? 0, 10) || 0, 0, exhMax);
  const exhP = exhMax ? (exhCur / exhMax) * 100 : 0;
  document.getElementById("exhBar").style.width = exhP + "%";
  document.getElementById("exhBar").style.background = exhP < 34 ? "var(--good)" : (exhP < 66 ? "var(--warn)" : "var(--bad)");
  document.getElementById("exhStatus").textContent = exhP < 34 ? "Fresh-ish." : (exhP < 66 ? "Flagging." : "Absolutely cooked.");

  const fedP = pct(state.fed, state.maxfed);
  document.getElementById("fedBar").style.width = fedP + "%";
  document.getElementById("fedBar").style.background = barColor(fedP);
  document.getElementById("fedStatus").textContent = statusGeneric(fedP, "Comfortably fed.", "Peckish. Dangerous.", "Hunger is driving.");

  renderConditions();
}

function exportState() {
  const out = document.getElementById("io");
  out.value = JSON.stringify(state, null, 2);
  out.focus();
  out.select();
}

function importState() {
  const raw = document.getElementById("io").value.trim();
  if (!raw) {
    alert("Paste exported JSON into the box first.");
    return;
  }
  try {
    const parsed = JSON.parse(raw);
    state = { ...DEFAULT_STATE, ...parsed, conditions: Array.isArray(parsed.conditions) ? parsed.conditions : [] };
    saveState();
    render();
  } catch (e) {
    alert("That JSON is cursed. Fix it and try again.");
  }
}

function resetAll() {
  if (!confirm("Reset everything to defaults?")) return;
  state = { ...DEFAULT_STATE, conditions: [] };
  saveState();
  render();
}

render();

// ---- Stat Block module (namespaced: TS_) ----
const TS_STAT_DEFAULTS = {'str': 6, 'dex': 16, 'con': 13, 'int': 12, 'wis': 14, 'cha': 14, 'prof': 2, 'profs': ['acrobatics', 'deception', 'stealth', 'charisma', 'dexterity']};
const TS_SKILLS = {'Athletics': 'str', 'Acrobatics': 'dex', 'Sleight of Hand': 'dex', 'Stealth': 'dex', 'Arcana': 'int', 'History': 'int', 'Investigation': 'int', 'Nature': 'int', 'Religion': 'int', 'Animal Handling': 'wis', 'Insight': 'wis', 'Medicine': 'wis', 'Perception': 'wis', 'Survival': 'wis', 'Deception': 'cha', 'Intimidation': 'cha', 'Performance': 'cha', 'Persuasion': 'cha'};
const TS_STAT_KEY = "tapSheet:baseStats:v2";

function TS_abilityMod(score){
  return Math.floor((Number(score) - 10) / 2);
}

function TS_loadBaseStats(){
  try {
    const raw = localStorage.getItem(TS_STAT_KEY);
    if(raw) {
      const obj = JSON.parse(raw);
      return {
        str: Number(obj.str ?? TS_STAT_DEFAULTS.str),
        dex: Number(obj.dex ?? TS_STAT_DEFAULTS.dex),
        con: Number(obj.con ?? TS_STAT_DEFAULTS.con),
        int: Number(obj.int ?? TS_STAT_DEFAULTS.int),
        wis: Number(obj.wis ?? TS_STAT_DEFAULTS.wis),
        cha: Number(obj.cha ?? TS_STAT_DEFAULTS.cha),
        prof: Number(obj.prof ?? TS_STAT_DEFAULTS.prof),
        profs: Array.isArray(obj.profs) ? obj.profs : TS_STAT_DEFAULTS.profs
      };
    }
  } catch(e) {}
  // structuredClone might not exist on older Safari, so be safe
  return {
    str: TS_STAT_DEFAULTS.str, dex: TS_STAT_DEFAULTS.dex, con: TS_STAT_DEFAULTS.con,
    int: TS_STAT_DEFAULTS.int, wis: TS_STAT_DEFAULTS.wis, cha: TS_STAT_DEFAULTS.cha,
    prof: TS_STAT_DEFAULTS.prof, profs: TS_STAT_DEFAULTS.profs
  };
}

function TS_saveBaseStats(bs){
  try { localStorage.setItem(TS_STAT_KEY, JSON.stringify(bs)); } catch(e) {}
}

function TS_resetBaseStats(){
  TS_saveBaseStats(TS_STAT_DEFAULTS);
  TS_renderStatBlock();
}

function TS_editBaseStats(){
  const bs = TS_loadBaseStats();
  const ask = (label, cur) => {
    const v = prompt(`Set ${label}:`, String(cur));
    if(v === null) return cur;
    const n = parseInt(v, 10);
    return Number.isFinite(n) ? n : cur;
  };
  bs.str = ask("STR", bs.str);
  bs.dex = ask("DEX", bs.dex);
  bs.con = ask("CON", bs.con);
  bs.int = ask("INT", bs.int);
  bs.wis = ask("WIS", bs.wis);
  bs.cha = ask("CHA", bs.cha);
  bs.prof = ask("Proficiency Bonus", bs.prof);

  const curList = (bs.profs || []).join(", ");
  const listIn = prompt("Proficient skills (comma-separated):", curList);
  if(listIn !== null) {
    bs.profs = listIn.split(",").map(s => s.trim()).filter(Boolean);
  }

  TS_saveBaseStats(bs);
  TS_renderStatBlock();
}

function TS_renderStatBlock(){
  const bs = TS_loadBaseStats();
  const mods = {
    str: TS_abilityMod(bs.str),
    dex: TS_abilityMod(bs.dex),
    con: TS_abilityMod(bs.con),
    int: TS_abilityMod(bs.int),
    wis: TS_abilityMod(bs.wis),
    cha: TS_abilityMod(bs.cha)
  };
  const profSet = new Set(bs.profs || []);

  const grid = document.getElementById("TS_abilityGrid");
  if(grid){
    grid.innerHTML = "";
    const order = ["str","dex","con","int","wis","cha"];
    const labels = {str:"STR",dex:"DEX",con:"CON",int:"INT",wis:"WIS",cha:"CHA"};
    for(const k of order){
      const div = document.createElement("div");
      div.className = "ability";
      const m = mods[k];
      div.innerHTML = `<div class="k">${labels[k]}</div>
                       <div class="v">${bs[k]}</div>
                       <div class="m">${m >= 0 ? "+" : ""}${m}</div>`;
      grid.appendChild(div);
    }
  }

  const skillsEl = document.getElementById("TS_skillsGrid");
  if(skillsEl){
    skillsEl.innerHTML = "";
    const names = Object.keys(TS_SKILLS);
    for(const sk of names){
      const ab = TS_SKILLS[sk];
      const val = mods[ab] + (profSet.has(sk) ? bs.prof : 0);
      const row = document.createElement("div");
      row.className = "skill";
      row.innerHTML = `<div class="name">${sk}${profSet.has(sk) ? '<span class="star">â˜…</span>' : ''}</div>
                       <div class="val">${val >= 0 ? "+" : ""}${val}</div>`;
      skillsEl.appendChild(row);
    }
  }

  const line = document.getElementById("TS_profLine");
  if(line){
    line.textContent = `â˜… proficient Â· proficiency bonus +${bs.prof}`;
  }
}

document.addEventListener("DOMContentLoaded", () => {
  try { TS_renderStatBlock(); } catch(e) {}
});

</script>
</body>
</html>
